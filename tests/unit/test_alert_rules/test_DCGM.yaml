rule_files:
  - ../../../src/prometheus_alert_rules/DCGM.yaml

tests:
  - interval: 1m
    input_series:
      - series: DCGM_FI_DEV_CLOCK_THROTTLE_REASONS{instance="ubuntu-0", gpu="0"}
        values: '32x15'  # Value indicating software thermal throttling (0x20)

    alert_rule_test:
      - eval_time: 10m
        alertname: GpuClockThrottlingDetected
        exp_alerts:
          - exp_labels:
              severity: warning
              instance: ubuntu-0
              gpu: "0"
            exp_annotations:
              summary: GPU clock throttling detected. (instance ubuntu-0)
              description: |
                GPU clock throttling has been detected on GPU 0.
                Throttle reasons (bitmask): 32
                Refer to the DCGM documentation for more information: https://docs.nvidia.com/datacenter/dcgm/2.1/dcgm-api/group__dcgmFieldConstants.html
                LABELS = map[__name__:DCGM_FI_DEV_CLOCK_THROTTLE_REASONS gpu:0 instance:ubuntu-0]
